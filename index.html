<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>世纪简码</title>
<style>*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}body{margin:0;height:100vh;display:flex;flex-direction:column;background:#fff;color:#000;overflow:hidden;font-family:system-ui,-apple-system,sans-serif}header{padding:15px 20px;display:flex;flex-direction:column;gap:10px;border-bottom:1px solid #000}#hd-top{display:flex;justify-content:space-between;align-items:center}h1{margin:0;font-size:18px;font-weight:900;text-transform:uppercase}#hd-btns{display:flex;gap:8px}.btn-s{padding:5px 10px;font-size:11px}#list-view{flex:1;overflow-y:auto;padding:0 20px;-webkit-overflow-scrolling:touch}.item{display:flex;justify-content:space-between;align-items:center;padding:20px 0;border-bottom:1px solid #eee}.item-name{font-size:16px;font-weight:400;color:#000;flex:1}.del-btn{font-size:12px;color:#999;border:none;background:none;padding:5px}#edit-view,#pre-view{position:fixed;top:0;left:0;right:0;bottom:0;display:none;flex-direction:column;background:#fff;z-index:99}.bar{padding:10px 16px;display:flex;align-items:center;border-bottom:1px solid #000;gap:6px;justify-content:flex-start}#fn{width:120px;border:none;outline:0;font-size:15px;font-weight:700;flex-shrink:1}#ed{flex:1;width:100%;padding:20px;outline:0;font-size:16px;line-height:1.6;color:#333;white-space:pre-wrap;word-break:break-all;overflow-y:auto;background:#fff}.h-lite{background-color:#000!important;color:#fff!important;display:inline;border-radius:2px}.btn{border:1px solid #000;background:none;padding:6px 16px;font-size:12px;text-transform:uppercase;font-weight:700;cursor:pointer;white-space:nowrap;margin-right:2px}.btn-black{background:#000;color:#fff}.fs-bar{padding:10px 20px;display:flex;align-items:center;font-size:11px;color:#999;border-bottom:1px solid #eee;justify-content:space-between}#search-bar{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);width:85%;background:#fff;border:1.5px solid #000;border-radius:30px;padding:5px 15px;display:none;align-items:center;z-index:100;box-shadow:0 4px 15px rgba(0,0,0,0.15)}#search-in{flex:1;border:none;outline:none;padding:10px;font-size:14px}</style></head>
<body><header><div id="hd-top"><h1>世纪简码</h1><button class="btn btn-black" onclick="edit('')">新建文件</button></div><div id="hd-btns"><button class="btn btn-s" onclick="bakOut()">备份全部</button><button class="btn btn-s" onclick="$('bakIn').click()">导入备份</button><input type="file" id="bakIn" style="display:none" onchange="bakLoad(this)" accept=".json"></div></header><div id="list-view"></div><div id="edit-view"><div class="bar"><input id="fn" spellcheck="false" placeholder="文件名"><button class="btn" onclick="save()">保存</button><button class="btn" onclick="exp()">导出</button><button class="btn" onclick="back()">返回</button><button class="btn btn-black" onclick="run()">运行</button></div><div class="fs-bar"><div><span>字体 </span><span onclick="setFs(-2)" style="cursor:pointer;color:#000;font-weight:700;padding:0 5px">—</span><span id="fv" style="color:#000">16px</span><span onclick="setFs(2)" style="cursor:pointer;color:#000;font-weight:700;padding:0 5px">＋</span></div><div style="display:flex;align-items:center"><svg onclick="toggleS()" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="margin-right:15px;cursor:pointer"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><span onclick="undo()" style="cursor:pointer;color:#000;font-weight:700;font-size:16px;padding:0 10px">←</span><span onclick="redo()" style="cursor:pointer;color:#000;font-weight:700;font-size:16px;padding:0 10px">→</span></div></div><div id="ed" contenteditable="true" spellcheck="false" oninput="handleInput()"></div><div id="search-bar"><input id="search-in" placeholder="搜< > / & 等一切符号..." oninput="doSearch()"><span onclick="toggleS()" style="font-weight:bold;padding:0 5px;cursor:pointer">✕</span></div></div><div id="pre-view"><div class="bar"><span id="pre-title" style="flex:1;font-weight:700;font-size:14px">预览</span><button class="btn" onclick="$('pre-view').style.display='none'">关闭预览</button></div><iframe id="ifr"></iframe></div>
<script>let db_idb,fs=16,his=[],hIdx=-1,curOldName='',rawText='',isSearching=false;const $=i=>document.getElementById(i),ed=$('ed');const request=indexedDB.open("EditorDB",1);request.onupgradeneeded=e=>{let d=e.target.result;d.createObjectStore("files",{keyPath:"id"});d.createObjectStore("history",{keyPath:"id"})};request.onsuccess=e=>{db_idb=e.target.result;render()};function render(){db_idb.transaction("files","readonly").objectStore("files").getAll().onsuccess=e=>{const f=e.target.result;$('list-view').innerHTML=f.length?'':'<div class="empty">未找到文件</div>';f.sort((a,b)=>a.id.localeCompare(b.id)).forEach(n=>{let d=document.createElement('div');d.className='item';d.innerHTML=`<div class="item-name" onclick="edit('${n.id}')">${n.id}</div><button class="del-btn" onclick="del('${n.id}')">删除</button>`;$('list-view').appendChild(d)})}}function edit(n){isSearching=false;$('edit-view').style.display='flex';curOldName=n;$('fn').value=n||'未命名.HTML';if(!n){ed.innerText='';rawText='';his=[''];hIdx=0;return}db_idb.transaction("files").objectStore("files").get(n).onsuccess=e=>{rawText=e.target.result.content;ed.innerText=rawText;db_idb.transaction("history").objectStore("history").get(n).onsuccess=e2=>{his=e2.target.result?e2.target.result.data:[rawText];hIdx=his.length-1}};ed.focus()}function handleInput(){if(isSearching)return;rawText=ed.innerText;if(hIdx<his.length-1)his=his.slice(0,hIdx+1);if(rawText!==his[hIdx]){his.push(rawText);if(his.length>30)his.shift();hIdx=his.length-1;saveHis($('fn').value)}}function undo(){if(hIdx>0){hIdx--;rawText=his[hIdx];ed.innerText=rawText;saveHis($('fn').value)}}function redo(){if(hIdx<his.length-1){hIdx++;rawText=his[hIdx];ed.innerText=rawText;saveHis($('fn').value)}}function saveHis(n){if(n)db_idb.transaction("history","readwrite").objectStore("history").put({id:n,data:his})}function save(){let n=$('fn').value,c=ed.innerText;if(!n)return alert('文件名');if(curOldName&&curOldName!==n){db_idb.transaction("files","readwrite").objectStore("files").delete(curOldName);db_idb.transaction("history","readwrite").objectStore("history").delete(curOldName)}db_idb.transaction("files","readwrite").objectStore("files").put({id:n,content:c});saveHis(n);curOldName=n;render();return true}function back(){$('edit-view').style.display='none';$('search-bar').style.display='none';isSearching=false;render()}function run(){save();$('ifr').srcdoc=ed.innerText;$('pre-view').style.display='flex';$('pre-title').innerText='预览: '+$('fn').value}function del(n){if(confirm('删除？')){db_idb.transaction("files","readwrite").objectStore("files").delete(n);db_idb.transaction("history","readwrite").objectStore("history").delete(n);render()}}function setFs(v){fs+=v;ed.style.fontSize=fs+'px';$('fv').innerText=fs+'px'}function exp(){if(save()){const n=$('fn').value,c=ed.innerText,b=new Blob([c],{type:'text/html'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download=n.endsWith('.HTML')?n:n+'.HTML';a.click()}}function bakOut(){db_idb.transaction("files").objectStore("files").getAll().onsuccess=e=>{const b=new Blob([JSON.stringify(e.target.result)],{type:'application/json'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download='备份_'+Date.now()+'.json';a.click()}}function bakLoad(i){const f=i.files[0];const r=new FileReader();r.onload=e=>{const data=JSON.parse(e.target.result),tx=db_idb.transaction("files","readwrite");data.forEach(item=>tx.objectStore("files").put(item));tx.oncomplete=()=>{render();alert('成功')}};r.readAsText(f)}function toggleS(){const b=$('search-bar');if(b.style.display==='flex'){isSearching=false;ed.innerText=rawText;b.style.display='none'}else{isSearching=true;b.style.display='flex';$('search-in').focus()}}const esc=s=>s.replace(/[<>&]/g,m=>({'<':'&lt;','>':'&gt;','&':'&amp;'})[m]);function doSearch(){const q=$('search-in').value;if(!q){ed.innerText=rawText;return}const safeFull=esc(rawText);const safeQ=esc(q).replace(/[.*+?^${}()|[\]\\]/g,'\\$&');const reg=new RegExp(safeQ,'g');ed.innerHTML=safeFull.replace(reg,'<span class="h-lite">$&</span>');const t=ed.querySelector('.h-lite');if(t)t.scrollIntoView({block:'center'})}</script></body></html>
